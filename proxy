/**
 * Query eSIM order status
 */
app.post('/esim-order-status', (req, res) => {
  const postData = JSON.stringify(req.body || {});

  const options = {
    hostname: 'api.esimaccess.com',
    path: '/api/v1/open/esim/query',
    method: 'POST',
    headers: {
      'RT-AccessCode': ACCESS_CODE,
      'Content-Type': 'application/json',
      'Content-Length': Buffer.byteLength(postData),
    },
  };

  const apiReq = https.request(options, (apiRes) => {
    let data = '';

    apiRes.on('data', (chunk) => (data += chunk));
    apiRes.on('end', () => {
      res.status(apiRes.statusCode).send(data);
    });
  });

  apiReq.on('error', (err) => {
    console.error('Error querying eSIM order:', err);
    res.status(500).json({ error: 'Internal server error' });
  });

  apiReq.write(postData);
  apiReq.end();
});
